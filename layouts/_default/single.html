{{ define "main" }}
<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }} - {{ .Site.Title }}</title>
    <meta name="description" content="{{ .Summary }}">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">

    <!-- Resource Hints -->
    {{ partial "resource-hints.html" . }}

    <!-- Single Post Stylesheet -->
    <link rel="stylesheet" href="{{ "css/single-post.css" | relURL }}">

    <!-- Force Dark Theme -->
    <script>
        document.documentElement.setAttribute('data-theme', 'dark');
    </script>

    <!-- SEO Meta Tags -->
    <meta name="author" content="Jake Park">
    {{ with .Params.tags }}<meta name="keywords" content="{{ delimit . ", " }}">{{ end }}

    <!-- Canonical URL -->
    {{ partial "canonical.html" . }}

    <!-- Hreflang for multilingual SEO -->
    {{ partial "hreflang.html" . }}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="{{ .Permalink }}">
    <meta property="og:title" content="{{ .Title }}">
    <meta property="og:description" content="{{ .Summary }}">
    {{ with .Params.image }}<meta property="og:image" content="{{ $.Site.BaseURL }}{{ . }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="{{ $.Title }}">{{ else }}<meta property="og:image" content="{{ $.Site.BaseURL }}/favicon.svg">{{ end }}
    <meta property="og:site_name" content="{{ .Site.Title }}">
    <meta property="og:locale" content="{{ if eq .Site.Language.Lang "en" }}en_US{{ else if eq .Site.Language.Lang "ko" }}ko_KR{{ else }}ja_JP{{ end }}">
    <meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
    <meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
    <meta property="article:author" content="Jake Park">
    {{ range .Params.categories }}<meta property="article:section" content="{{ . }}">{{ end }}
    {{ range .Params.tags }}<meta property="article:tag" content="{{ . }}">{{ end }}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ .Permalink }}">
    <meta name="twitter:title" content="{{ .Title }}">
    <meta name="twitter:description" content="{{ .Summary }}">
    {{ with .Params.image }}<meta name="twitter:image" content="{{ $.Site.BaseURL }}{{ . }}">
    <meta name="twitter:image:alt" content="{{ $.Title }}">{{ else }}<meta name="twitter:image" content="{{ $.Site.BaseURL }}/favicon.svg">{{ end }}
    <meta name="twitter:creator" content="@jakeinsights">
    <meta name="twitter:site" content="@jakeinsights">
    <meta name="twitter:label1" content="Reading time">
    <meta name="twitter:data1" content="{{ .ReadingTime }} min read">

    <!-- Schema.org JSON-LD: Article -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "headline": "{{ .Title }}",
      "image": {{ with .Params.image }}"{{ $.Site.BaseURL }}{{ . }}"{{ else }}"{{ $.Site.BaseURL }}/favicon.svg"{{ end }},
      "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
      "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
      "author": {
        "@type": "Person",
        "name": "Jake Park",
        "url": "{{ .Site.BaseURL }}/about/"
      },
      "publisher": {
        "@type": "Organization",
        "name": "{{ .Site.Title }}",
        "logo": {
          "@type": "ImageObject",
          "url": "{{ .Site.BaseURL }}/favicon.svg",
          "width": 600,
          "height": 60
        }
      },
      "description": "{{ .Summary | plainify }}",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "{{ .Permalink }}"
      },
      "wordCount": {{ .WordCount }},
      "articleSection": {{ with .Params.categories }}"{{ index . 0 }}"{{ else }}"Article"{{ end }},
      "keywords": {{ with .Params.tags }}"{{ delimit . ", " }}"{{ else }}"blog, insights, {{ index (.Params.categories | default slice) 0 }}"{{ end }},
      "inLanguage": "{{ .Site.Language.Lang }}"
    }
    </script>

    <!-- Schema.org JSON-LD: BreadcrumbList -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "{{ .Site.BaseURL }}/{{ .Site.Language.Lang }}/"
        }{{ with .Params.categories }},
        {
          "@type": "ListItem",
          "position": 2,
          "name": "{{ index . 0 | title }}",
          "item": "{{ $.Site.BaseURL }}/{{ $.Site.Language.Lang }}/categories/{{ index . 0 | urlize }}/"
        }{{ end }},
        {
          "@type": "ListItem",
          "position": 3,
          "name": "{{ .Title }}",
          "item": "{{ .Permalink }}"
        }
      ]
    }
    </script>

    <!-- Schema.org JSON-LD: Organization (for brand identity) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "{{ .Site.Title }}",
      "url": "{{ .Site.BaseURL }}",
      "logo": "{{ .Site.BaseURL }}/favicon.svg",
      "sameAs": [
        "https://github.com/Maverick-jkp"
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "Customer Service",
        "url": "{{ .Site.BaseURL }}/about/"
      }
    }
    </script>
</head>
<body>
    <!-- Reading Progress Bar -->
    <div id="reading-progress">
        <div id="reading-progress-bar"></div>
    </div>

    <header>
        <div class="header-content">
            <a href="/{{ .Site.Language.Lang }}/" class="logo">JAKE<span>'</span>S <span>INSIGHTS</span></a>
        </div>
    </header>

    <!-- Breadcrumbs -->
    {{ partial "breadcrumbs.html" . }}

    <article{{ with .Params.ab_test_id }} data-ab-test="{{ . }}"{{ end }}{{ with .Params.ab_variant }} data-ab-variant="{{ . }}"{{ end }}>
        {{/* Hero Image removed - image appears in article content already */}}

        <div class="article-header">
            <h1>{{ .Title }}</h1>
            <div class="meta">
                <span>{{ .Date.Format "January 02, 2006" }}</span>
                <span>‚è±Ô∏è {{ .ReadingTime }} min read</span>
            </div>
        </div>

        <!-- Ad Slot 1: Top of Article -->
        <div class="ad-container ad-top">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-2478912111812328"
                 data-ad-slot="auto"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <div class="content">
            {{ .Content }}
        </div>

        <!-- Ad Slot 2: After Content -->
        <div class="ad-container ad-mid">
            <ins class="adsbygoogle"
                 style="display:block; text-align:center"
                 data-ad-layout="in-article"
                 data-ad-format="fluid"
                 data-ad-client="ca-pub-2478912111812328"
                 data-ad-slot="auto"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <!-- Social Share Buttons -->
        {{ if .Site.Params.ShowShareButtons }}
        <div class="social-share">
            <h3 class="social-share-title">Share this article</h3>
            <div class="share-buttons">
                {{- $url := .Permalink -}}
                {{- $title := .Title -}}

                <!-- Twitter/X -->
                <a href="https://twitter.com/intent/tweet?url={{ $url }}&text={{ $title }}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="share-btn"
                   aria-label="Share on Twitter">
                    <span class="icon">ùïè</span>
                    <span>Twitter</span>
                </a>

                <!-- Facebook -->
                <a href="https://www.facebook.com/sharer/sharer.php?u={{ $url }}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="share-btn"
                   aria-label="Share on Facebook">
                    <span class="icon">f</span>
                    <span>Facebook</span>
                </a>

                <!-- LinkedIn -->
                <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ $url }}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="share-btn"
                   aria-label="Share on LinkedIn">
                    <span class="icon">in</span>
                    <span>LinkedIn</span>
                </a>

                <!-- Copy Link -->
                <button onclick="navigator.clipboard.writeText('{{ $url }}').then(() => { this.innerHTML = '<span class=icon>‚úì</span><span>Copied!</span>'; setTimeout(() => { this.innerHTML = '<span class=icon>üîó</span><span>Copy Link</span>'; }, 2000); })"
                        class="share-btn"
                        aria-label="Copy link to clipboard">
                    <span class="icon">üîó</span>
                    <span>Copy Link</span>
                </button>
            </div>
        </div>
        {{ end }}

        <!-- Ad Slot 3: Before Related Posts -->
        <div class="ad-container ad-bottom">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-2478912111812328"
                 data-ad-slot="auto"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <!-- You Might Also Like Section -->
        {{- $currentLang := .Site.Language.Lang -}}
        {{- $currentPage := . -}}
        {{- $allPosts := where .Site.RegularPages "Section" "ne" "" -}}
        {{- $sameLangPosts := where $allPosts ".Language.Lang" $currentLang -}}
        {{- $otherPosts := $sameLangPosts | shuffle | first 8 -}}
        {{- $filteredPosts := slice -}}
        {{- range $otherPosts -}}
            {{- if ne .Permalink $currentPage.Permalink -}}
                {{- $filteredPosts = $filteredPosts | append . -}}
            {{- end -}}
        {{- end -}}
        {{- $related := $filteredPosts | first 4 -}}

        {{ with $related }}
        <div class="related-posts">
            <h3 class="related-title">You Might Also Like</h3>
            <div class="related-grid">
                {{ range . }}
                <a href="{{ .Permalink }}" class="related-card">
                    <div class="related-thumbnail">
                        {{ with .Params.image }}
                            <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy" width="400" height="225">
                        {{ else }}
                            <div class="no-image">üìÑ</div>
                        {{ end }}
                    </div>
                    <h4>{{ .Title }}</h4>
                    <p>{{ .Summary | plainify | truncate 80 }}</p>
                </a>
                {{ end }}
            </div>
        </div>
        {{ end }}

        <a href="/{{ .Site.Language.Lang }}/" class="back-link">‚Üê Back to Home</a>
    </article>

    <!-- Footer -->
    {{ partial "footer.html" . }}

    <!-- Floating Menu -->
    <div class="floating-menu">
        <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
        <div class="menu-panel" id="menuPanel">
            <a href="#top">‚Üë Top</a>
            <a href="{{ "/" | relLangURL }}" style="font-weight: 600;">üè† Home</a>
            <a href="{{ "all-posts" | relLangURL }}" style="color: var(--accent); font-weight: 600;">üìã All Posts</a>
            <div style="border-top: 1px solid var(--border); margin: 0.5rem 0; padding-top: 0.5rem;">
                <div style="font-size: 0.75rem; color: var(--accent); padding: 0 1rem 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">Categories</div>
                <div class="category-grid">
                    {{ if eq .Site.Language.Lang "en" }}
                    <a href="/categories/tech/"><span class="cat-icon">üíª</span><span class="cat-text">Tech</span></a>
                    <a href="/categories/business/"><span class="cat-icon">üíº</span><span class="cat-text">Business</span></a>
                    <a href="/categories/society/"><span class="cat-icon">üåç</span><span class="cat-text">Society</span></a>
                    <a href="/categories/entertainment/"><span class="cat-icon">üé¨</span><span class="cat-text">Entertainment</span></a>
                    <a href="/categories/sports/"><span class="cat-icon">‚öΩ</span><span class="cat-text">Sports</span></a>
                    {{ else }}
                    <a href="/{{ .Site.Language.Lang }}/categories/tech/"><span class="cat-icon">üíª</span><span class="cat-text">Tech</span></a>
                    <a href="/{{ .Site.Language.Lang }}/categories/business/"><span class="cat-icon">üíº</span><span class="cat-text">Business</span></a>
                    <a href="/{{ .Site.Language.Lang }}/categories/society/"><span class="cat-icon">üåç</span><span class="cat-text">Society</span></a>
                    <a href="/{{ .Site.Language.Lang }}/categories/entertainment/"><span class="cat-icon">üé¨</span><span class="cat-text">Entertainment</span></a>
                    <a href="/{{ .Site.Language.Lang }}/categories/sports/"><span class="cat-icon">‚öΩ</span><span class="cat-text">Sports</span></a>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleMenu() {
            const panel = document.getElementById('menuPanel');
            panel.classList.toggle('active');
        }

        document.addEventListener('click', function(event) {
            const menu = document.querySelector('.floating-menu');
            if (!menu.contains(event.target)) {
                document.getElementById('menuPanel').classList.remove('active');
            }
        });

        // Reading progress bar
        (function() {
            const progressBar = document.getElementById('reading-progress-bar');
            if (!progressBar) return;

            const updateProgress = () => {
                const windowHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;
                const scrollTop = window.scrollY || document.documentElement.scrollTop;
                const maxScroll = documentHeight - windowHeight;
                const progress = maxScroll > 0 ? (scrollTop / maxScroll) * 100 : 0;
                progressBar.style.width = `${Math.min(progress, 100)}%`;
            };

            let ticking = false;
            window.addEventListener('scroll', () => {
                if (!ticking) {
                    window.requestAnimationFrame(() => {
                        updateProgress();
                        ticking = false;
                    });
                    ticking = true;
                }
            });

            updateProgress();
        })();
    </script>

    <!-- GA4 Event Tracking -->
    {{ partial "ga4-events.html" . }}
</body>
</html>
{{ end }}
