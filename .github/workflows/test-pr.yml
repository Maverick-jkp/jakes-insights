name: Test PR Workflow

on:
  workflow_dispatch:
    inputs:
      test_message:
        description: 'Test message to include'
        required: false
        default: 'Test run'

jobs:
  test-pr-creation:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create dummy test files
        run: |
          mkdir -p content/generated/test
          TIMESTAMP=$(date +%Y%m%d-%H%M%S)

          cat > content/generated/test/dummy-${TIMESTAMP}.md << 'EOF'
          ---
          title: "Test Post - ${{ github.event.inputs.test_message }}"
          date: $(date +%Y-%m-%d)
          draft: false
          categories: ["tech"]
          tags: ["test", "automation"]
          description: "Automated test post generated at $(date)"
          ---

          # Test Content

          This is a test post created by the automated PR workflow.

          - Generated at: $(date)
          - Run ID: ${{ github.run_id }}
          - Test message: ${{ github.event.inputs.test_message }}

          ## Purpose

          Testing the PR creation workflow to ensure:
          1. Files are created correctly
          2. PR is generated with proper metadata
          3. Workflow can be triggered manually

          EOF

          echo "Created test file: dummy-${TIMESTAMP}.md"
          ls -la content/generated/test/

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "test: Add dummy post for PR workflow testing"
          title: "ðŸ§ª Test: PR Workflow Validation"
          body: |
            ## ðŸ§ª Test PR - Workflow Validation

            This PR was automatically created to test the PR workflow functionality.

            ### Generated Files
            - Test post in `content/generated/test/`

            ### Test Details
            - **Run ID**: ${{ github.run_id }}
            - **Timestamp**: $(date)
            - **Test Message**: ${{ github.event.inputs.test_message }}

            ### Next Steps
            - [ ] Verify file was created correctly
            - [ ] Check PR metadata is correct
            - [ ] Confirm branch naming works

            ---
            ðŸ¤– Generated by automated PR workflow
          branch: test/pr-workflow-${{ github.run_id }}
          delete-branch: true
          labels: |
            test
            automated
